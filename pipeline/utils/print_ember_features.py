import sys
import hashlib
import numpy as np

from ember.features import PEFeatureExtractor

tags = ['adware', 'flooder', 'ransomware', 'dropper', 'spyware', 'packed', 'crypto_miner', 'file_infector', 'installer', 'worm', 'downloader']

if '-header' in sys.argv:
    print(",".join(['sha', 'class'] + tags + [f'feature_{x}' for x in range(2831)]))
else:
    
    with open(sys.argv[1], 'rb') as binary:
        malware = binary.read()
    
    sha = hashlib.sha256(malware).hexdigest();
    
    y = [int("-{}".format(t) in sys.argv) for t in tags]
    
    class_ = int("".join(str(x) for x in y), 2)
    
    extractor = PEFeatureExtractor(2)
    features = list(extractor.feature_vector(malware))
    
    print(",".join([sha, str(class_)] + [str(v) for v in y] + [str(f) for f in features]))