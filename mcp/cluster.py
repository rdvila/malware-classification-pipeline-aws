from troposphere import (
    Base64,
    FindInMap,
    GetAtt,
    GetAZs,
    Join,
    Output,
    Parameter,
    Ref,
    Select,
    Tags,
    Template,
)
from troposphere.ec2 import (
    EIP,
    VPC,
    Instance,
    InternetGateway,
    NetworkAcl,
    NetworkAclEntry,
    NetworkInterfaceProperty,
    PortRange,
    Route,
    RouteTable,
    SecurityGroup,
    SecurityGroupRule,
    Subnet,
    SubnetNetworkAclAssociation,
    SubnetRouteTableAssociation,
    VPCGatewayAttachment,
)
from troposphere.ecs import (
    AwsvpcConfiguration,
    Cluster,
    ContainerDefinition,
    NetworkConfiguration,
    PortMapping,
    Service,
    TaskDefinition
)

t = Template()
t.set_version("2010-09-09")

vpc = t.add_resource(
    VPC(
        "VPC",
        CidrBlock = "10.192.0.0/16",
        EnableDnsHostnames=True,
        EnableDnsSupport=True,
        Tags=Tags(CreatedBy='malware-pipeline'),
    )
)

privatesubnet1 = t.add_resource(
    Subnet(
        "PrivateSubnet1",
        CidrBlock="10.192.10.0/24",
        VpcId=Ref(vpc),
        AvailabilityZone=Select(0, GetAZs('')),
        MapPublicIpOnLaunch=False,
        Tags=Tags(CreatedBy='malware-pipeline')
    )
)

privatesubnet2 = t.add_resource(
    Subnet(
        "PrivateSubnet2",
        CidrBlock="10.192.11.0/24",
        VpcId=Ref(vpc),
        AvailabilityZone=Select(1, GetAZs('')),
        MapPublicIpOnLaunch=False,
        Tags=Tags(CreatedBy='malware-pipeline')
    )
)

privateroutetable1=t.add_resource(
    RouteTable(
        "PrivateRouteTable1",
        VpcId=Ref(vpc),
        Tags=Tags(CreatedBy='malware-pipeline')
    )
)

privateroutetable2=t.add_resource(
    RouteTable(
        "PrivateRouteTable2",
        VpcId=Ref(vpc),
        Tags=Tags(CreatedBy='malware-pipeline')
    )
)

privroutetableassociation1=t.add_resource(
    SubnetRouteTableAssociation(
        "PrivateSubnet1RouteTableAssociation",
        RouteTableId=Ref(privateroutetable1),
        SubnetId=Ref(privatesubnet1)
    )
)

privroutetableassociation2=t.add_resource(
    SubnetRouteTableAssociation(
        "PrivateSubnet2RouteTableAssociation",
        RouteTableId=Ref(privateroutetable2),
        SubnetId=Ref(privatesubnet2)
    )
)

with open('cluster.yml', 'w') as f:
    f.write(template.to_yaml())


