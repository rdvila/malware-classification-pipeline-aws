from troposphere import Tags, Tag, Template
import troposphere.s3 as s3

template = Template()\
template.set_version("2010-09-09")

default_tags = Tags(
    Tag('createdBy', 'MalwareTypeClassificationProject')
)

bucket = s3.Bucket('MalwareClassificationBucket',
                   DeletionPolicy='Retain', UpdateReplacePolicy='Retain')
bucket.NotificationConfiguration = s3.NotificationConfiguration(
    EventBridgeConfiguration=s3.EventBridgeConfiguration(
        EventBridgeEnabled=True
    )
)
bucket.LifecycleConfiguration = s3.LifecycleConfiguration(
    Rules=[s3.LifecycleRule(
        Id='MetadataRule',
        Prefix='metadata',
        Status='Enabled',
        Transitions=[s3.LifecycleRuleTransition(
            TransitionInDays=180,
            StorageClass='STANDARD_IA'
        )]
    )]
)

bucket.Tags = default_tags

template.add_resource(bucket)

with open('bootstrap.yml', 'w') as f:
    f.write(template.to_yaml())
